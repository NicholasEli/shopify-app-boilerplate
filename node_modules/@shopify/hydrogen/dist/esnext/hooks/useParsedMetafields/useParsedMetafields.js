import { useMemo } from 'react';
import { flattenConnection, parseMetafieldValue } from '../../utilities';
/**
 * The `useParsedMetafields` hook transforms a [MetafieldConnection](/api/storefront/reference/common-objects/metafieldconnection)
 * in an array of metafields whose `values` have been parsed according to the metafield `type`.
 */
export function useParsedMetafields(
/** A [MetafieldConnection](/api/storefront/reference/common-objects/metafieldconnection). */
metafields) {
    var _a, _b;
    (_b = (_a = metafields === null || metafields === void 0 ? void 0 : metafields.edges) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.node;
    return useMemo(() => {
        if (!metafields) {
            throw new Error(`'useParsedMetafields' needs metafields`);
        }
        return flattenConnection(metafields).map((metafield) => {
            return {
                ...metafield,
                value: parseMetafieldValue(metafield),
            };
        });
    }, [metafields]);
}
